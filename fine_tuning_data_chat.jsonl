{"messages": [{"role": "system", "content": "\nYou are an expert SQL query generation assistant. Refer the schema context for the tables and sample user queries, to generate relevant SQL queries. Use Snowflake SQL syntax, optimize for performance, and structure the query correctly.\n\n"}, {"role": "assistant", "content": "Got it! I will generate only optimized SQL queries by referencing the schema context and sample queries as per questions asked."}]}
{"messages": [{"role": "system", "content": "The 'partner_onboarding_lead_creation' table has columns: owner_id (number) Unique identifier for the owner associated with the vehicle | not_null, owner_created_at_ist (timestamp_ntz) Timestamp when the owner record was created, in IST, supply_created_at_ist (timestamp_ntz) Timestamp when the supply record was created, in IST, owner_creation_tat_sec (number) Time taken in seconds between the supply created and the owner created, partner_onboarding_lead_id (number) Unique identifier for the lead being onboarded | not_null, unique, lead_mobile (varchar) Mobile number associated with the supply lead, lead_created_at_ist (timestamp_ntz) Timestamp when the lead record was created, in IST | not_null, uuid (varchar) Universal unique ID for vehicle | unique, status (number) Current status of the lead (status can be 0,1,2,3), owner_driver (boolean) Indicates if the driver is assigned as the lead owner, driver_id (number) Unique identifier for the driver, language (varchar) Language preference of the driver, onboarding_status (number) Status of driver's onboarding (status can be 0,1,2,3,4)\n- 0: Onboarding document verified\n- 1: Onboarding trainee\n- 2: Onboarding ready\n- 3: Onboarding acquired\n- 4: Onboarding completed, training_status (number) Status of the driver's training completion (status can be 0,1,2,3,4)\n- 0: trainee onboarding\n- 1: training onboarding completed\n- 2: payout trainee\n- 3: trainee RNR\n- 4: driver training completed, training_lang (varchar) Language used for driver training, termination_ts (timestamp_ntz) Timestamp when the driver's account was terminated, if applicable, terminating_admin_id (number) ID of the admin who terminated the driver's account, app_version (number) Version of the app used by the driver, reg_fee_payment_attempted (boolean) Flag indicating if the driver attempted to pay the registration fee, vehicle_number (varchar) The registration number of the vehicle, driver_onboardee_id (number) ID of the onboardee associated with the driver, geo_region_id (number) Unique identifier for the geo region, vehicle_id (number) Unique identifier for the vehicle, vehicle_created_at_ist (timestamp_ntz) Timestamp when the vehicle record was created, in IST, lead_rank (number) Ranking of the lead in the system, lead_creation_tat_sec (number) Time taken for the lead record creation, in seconds, from the owner's creation timestamp, reg_fee_paid (boolean) Flag indicating whether the registration fee has been paid for the lead, reg_fee_paid_amount (number) Amount paid for the registration fee by the lead, reg_fee_paid_at_ist (timestamp_ntz) Timestamp when the registration fee was paid, in IST, reg_fee_refunded_amount (number) Amount refunded for the registration fee, if applicable, reg_fee_refunded_at_ist (timestamp_ntz) Timestamp when the registration fee was refunded, in IST"}, {"role": "assistant", "content": "I have understood the schema of table 'partner_onboarding_lead_creation' and its columns and will refer to it for generating SQL queries."}]}
{"messages": [{"role": "system", "content": "The 'partner_onboarding_driver_creation' table has columns: driver_id (number) Unique identifier for the driver | not_null, unique, driver_created_at_ist (timestamp_ntz) Timestamp when the driver record was created, in IST, date_of_join (date) Date the driver joined the platform, active_status (number) Indicates if the driver is active or inactive on the platform.\n- 1: Terminated\n- 0: Active\n- Other: Pending Onboarding, partner_owner_id (number) Unique identifier for the owner of the partner., owner_id (number) Unique identifier for the owner associated with the driver, supply_created_at_ist (timestamp_ntz) Timestamp when the supply was created, in IST, owner_created_at_ist (timestamp_ntz) Timestamp when the owner was created, in IST, vehicle_created_at_ist (timestamp_ntz) Timestamp when the vehicle was created, in IST, vehicle_number (varchar) Vehicle number associated with the driver, vehicle_id (number) Unique identifier for the vehicle associated with the driver., vehicle_type (varchar) Categorizes vehicles into types such as Light Commercial Vehicles (e.g., Eeco, Tata Ace), Pickup Trucks (e.g., Tata 407, Pickup 1.7Ton), Two-Wheelers (e.g., 2 Wheeler, 2 Wheeler Low Speed EV), Three-Wheelers (e.g., 3 Wheeler Electric, E Loader), and specialized vehicles (e.g., Tata Ace Closed), category_segment (varchar) Segment classification of the vehicle as 2.5T+, 2W, 3W, 7ft, 8ft, 9ft, Champion, Compact 3W, E Loader, EV, Eeco, Not-Recognized, Upto 2.5T, vehicle_mapping (varchar) Mapping of the vehicle to a specific classification as 10ft, 14ft, 17ft, 19ft, 2W, 3W, 7ft, 8ft, 9ft, Compact_3W, E Loader, Others, level0_mapping (varchar) Classification of the vehicle as 2W, LCV, HCV, Micro LCV, Not-Recognized. This mapping is used for the vehicle category., city_name (varchar) Name of the city where the driver is located., zone (varchar) Zone classification for the driver's location(It can be West, North, South), tier (varchar) If the city is one of Mumbai, Delhi NCR, Bangalore, Hyderabad, Chennai, Ahmedabad, Pune, or Kolkata, classified as Tier 1, Otherwise, Tier 2, lead_created_at_ist (timestamp_ntz) Timestamp when the lead record was created, in IST, owner_driver (boolean) Indicates if the driver is assigned as the lead owner, reg_fee_paid_at_ist (timestamp_ntz) Timestamp when the registration fee was paid, in IST, onboarding_status (number) Status of driver's onboarding (status can be 0,1,2,3,4)\n- 0: onboarding document verified\n- 1: onboarding trainee\n- 2: onboarding ready\n- 3: onboarding acquired\n- 4  onboarding completed, training_status (number) Status of the driver's training completion (status can be 0,1,2,3,4)\n- 0: trainee onboarding\n- 1: training onboarding completed\n- 2: payout trainee\n- 3: trainee RNR\n- 4: driver training completed, first_dummy_order_allocated_ts_ist (timestamp_ntz) Timestamp when the first dummy order was allocated to the driver, in IST, first_dummy_order_completed_ts_ist (timestamp_ntz) Timestamp when the first dummy order was completed by the driver, in IST where order status=4, first_spot_order_allocated_ts_ist (timestamp_ntz) Timestamp when the first spot order was allocated to the driver, in IST., first_spot_order_completed_ts_ist (timestamp_ntz) Timestamp when the first spot order was completed by the driver, in IST where order status=4, dummy_orders_allocated (number) Number of dummy orders allocated to the driver, dummy_orders_completed (number) Number of dummy orders completed by the driver where order status=4, first_30d_orders_allocated (number) Number of orders allocated to the driver within the first 30 days of activation, first_7d_orders_allocated (number) Number of orders allocated to the driver within the first 7 days of activation, first_30d_orders_done (number) Number of orders completed by the driver within the first 30 days of activation where order status=4, first_7d_orders_done (number) Number of orders completed by the driver within the first 7 days of activation where order status=4, first_30d_earnings (number) Total earnings of the driver within the first 30 days of activation, first_7d_earnings (number) Total earnings of the driver within the first 7 days of activation, vehicle_category (varchar) The type of vehicle associated with the owner 2W, LCV, HCV, Not Recognized"}, {"role": "assistant", "content": "I have understood the schema of table 'partner_onboarding_driver_creation' and its columns and will refer to it for generating SQL queries."}]}
{"messages": [{"role": "system", "content": "The 'partner_onboarding_owner_creation' table has columns: supply_lead_id (number) Unique identifier for the supply lead | not_null, mobile (varchar) Mobile number associated with the supply lead, supply_created_at_ist (timestamp_ntz) Timestamp when the supply lead was created, in IST, supply_lead_rnk (number) Rank or priority assigned to the supply lead, owner_id (number) Unique identifier for the owner associated with the supply lead, owner_created_at_ist (timestamp_ntz) Timestamp when the owner record was created, in IST, owner_id_doc_id (number) Document ID for the Aadhar document of the owner, if available, pan_card_doc_id (number) Document ID for the PAN card of the owner, if available, owner_selfie_doc_id (number) Document ID for the owner's selfie, if available, owner_id_updated_at (timestamp_ntz) Last updated timestamp for the Aadhar document, pan_card_updated_at (timestamp_ntz) Last updated timestamp for the PAN card document, owner_selfie_updated_at (timestamp_ntz) Last updated timestamp for the owner's selfie, owner_id_num_tries (number) Total number of upload attempts for the Aadhar document, pan_card_num_tries (number) Total number of upload attempts for the PAN card document, owner_selfie_num_tries (number) Total number of upload attempts for the owner's selfie, aadhar_uploaded (boolean) Flag indicating whether the Aadhar document has been uploaded by the owner, pan_uploaded (boolean) Flag indicating whether the PAN card document has been uploaded by the owner, selfie_uploaded (boolean) Flag indicating whether the selfie document has been uploaded by the owner, owner_creation_tat_sec (number) Time taken for the owner record creation, in seconds, since the supply lead was created, doc_submission_tat (number) Time taken for the document submission process, in seconds, from supply lead creation to the last document update"}, {"role": "assistant", "content": "I have understood the schema of table 'partner_onboarding_owner_creation' and its columns and will refer to it for generating SQL queries."}]}
{"messages": [{"role": "system", "content": "The 'partner_onboarding_vehicle_creation' table has columns: owner_id (number) Unique identifier for the owner associated with the vehicle, owner_created_at_ist (timestamp_ntz) Timestamp when the owner record was created, in IST, supply_created_at_ist (timestamp_ntz) Timestamp when the supply record was created, in IST, owner_creation_tat_sec (number) Time taken in seconds between the supply created and the owner created, onboarding_vehicle_id (number) Unique identifier for the vehicle being onboarded | not_null, unique, vehicle_created_at_ist (timestamp_ntz) Timestamp when the vehicle record was created, in IST, vehicle_number (varchar) The registration number of the vehicle, body_type (varchar) The body type of the vehicle such as bike, closed, open, scooter, backdoor_closed, bike, closed, container, open, scooter, vehicle_id (number) Unique identifier for the vehicle, which is mapping to vehicle dimensions and specifications., vehicle_mapping (varchar) Standardized mapping of vehicle classification as 10ft, 14ft, 17ft, 19ft, 2W, 3W, 7ft, 8ft, 9ft, Compact_3W, E Loader, Others, level0_mapping (varchar) Level 0 vehicle categorization as 2W, HCV, LCV, Micro LCV, Not-Recognized, vehicle_category (varchar) The type of vehicle associated with the owner which can be 2W, Trucks, Others, vehicle_type (varchar) Categorizes vehicles into types such as Light Commercial Vehicles (e.g., Eeco, Tata Ace), Pickup Trucks (e.g., Tata 407, Pickup 1.7Ton), Two-Wheelers (e.g., 2 Wheeler, 2 Wheeler Low Speed EV), Three-Wheelers (e.g., 3 Wheeler Electric, E Loader), and specialized vehicles (e.g., Tata Ace Closed), city_name (varchar) Name of the city where the vehicle is based, zone (varchar) Operational zone in which the vehicle is categorized (North, South, West), tier (varchar) If the city is one of Mumbai, Delhi NCR, Bangalore, Hyderabad, Chennai, Ahmedabad, Pune, or Kolkata, classified as Tier 1. Otherwise, Tier 2, vehicle_creation_tat_sec (number) Time taken for the vehicle record creation, in seconds, from the owner's creation timestamp., status (number) Current status of the vehicle onboarding process (which can be 0,1)\n- 0 : Active\n- 1 : Inactive, uuid (varchar) Unique identifier for tracking the vehicle onboarding session, vehicle_rank (number) Rank or priority assigned to the vehicle, lead_id (number) Lead ID associated with the vehicle, vehicle_rc_doc_id (number) Document ID for the vehicle registration certificate (RC), if available, fitness_certificate_doc_id (number) Document ID for the fitness certificate, if available, vehicle_insurance_doc_id (number) Document ID for the vehicle insurance, if available, vehicle_tax_doc_id (number) Document ID for the vehicle tax, if available, vehicle_puc_doc_id (number) Document ID for the vehicle pollution under control (PUC) certificate, if available, vehicle_rc_updated_at (timestamp_ntz) Last updated timestamp for the vehicle registration certificate (RC), fitness_certificate_updated_at (timestamp_ntz) Last updated timestamp for the fitness certificate, vehicle_insurance_updated_at (timestamp_ntz) Last updated timestamp for the vehicle insurance document, vehicle_tax_updated_at (timestamp_ntz) Last updated timestamp for the vehicle tax document, vehicle_puc_updated_at (timestamp_ntz) Last updated timestamp for the vehicle pollution under control (PUC) certificate, vehicle_rc_num_tries (number) Total number of upload attempts for the vehicle registration certificate (RC), fitness_certificate_num_tries (number) Total number of upload attempts for the fitness certificate, vehicle_insurance_num_tries (number) Total number of upload attempts for the vehicle insurance document, vehicle_tax_num_tries (number) Total number of upload attempts for the vehicle tax document, vehicle_puc_num_tries (number) Total number of upload attempts for the vehicle pollution under control (PUC) certificate, vehicle_rc_uploaded (boolean) Flag indicating whether the vehicle registration certificate (RC) has been uploaded., fitness_certificate_uploaded (boolean) Flag indicating whether the fitness certificate for the vehicle has been uploaded, vehicle_insurance_uploaded (boolean) Flag indicating whether the vehicle insurance document has been uploaded, vehicle_tax_uploaded (boolean) Flag indicating whether the vehicle tax document has been uploaded., vehicle_puc_uploaded (boolean) Flag indicating whether the vehicle's pollution under control (PUC) certificate has been uploaded."}, {"role": "assistant", "content": "I have understood the schema of table 'partner_onboarding_vehicle_creation' and its columns and will refer to it for generating SQL queries."}]}
{"messages": [{"role": "system", "content": "The 'partner_onboarding_document_approval' table has columns: doc_created_at_ist_daywise (timestamp_ntz) Date (IST) when the document status was recorded, truncated to day level | not_null, document_name (varchar) Name of the onboarding document | not_null, doc_status_id (number) Unique identifier for the document status can be 1,2,3,4,5 | not_null, doc_status (varchar) Current status of the document, when the doc_status_id is\n1 : Waiting for Approval\n2 : Accepted\n3 : Rejected\n4 : Submitted\n5 : Auto Approve | not_null, actual_actioned_by (varchar) Indicates if the document was processed as auto, manual, null, doc_status_reason (varchar) Reason associated with the document's current status, if applicable, doc_count (number) Number of documents in the given status for the specified day | not_null"}, {"role": "assistant", "content": "I have understood the schema of table 'partner_onboarding_document_approval' and its columns and will refer to it for generating SQL queries."}]}
{"messages": [{"role": "user", "content": "This query counts the number of unique leads created, filtering out terminated leads."}, {"role": "assistant", "content": "WITH leads AS ( SELECT pl.partner_onboarding_lead_id, pl.termination_ts FROM mart.partner_onboarding_lead_creation pl WHERE pl.termination_ts IS NULL) SELECT COUNT(DISTINCT partner_onboarding_lead_id) AS leads_added FROM leads;"}]}
{"messages": [{"role": "user", "content": "This query counts the number of leads that have added a vehicle"}, {"role": "assistant", "content": "WITH leads AS (SELECT pl.partner_onboarding_lead_id, pl.termination_ts, pv.onboarding_vehicle_id FROM mart.partner_onboarding_lead_creation pl LEFT JOIN mart.partner_onboarding_vehicle_creation pv ON pl.partner_onboarding_lead_id = pv.lead_id WHERE pl.termination_ts IS NULL) SELECT COUNT(DISTINCT partner_onboarding_lead_id) AS leads_with_vehicle FROM leads WHERE onboarding_vehicle_id IS NOT NULL;"}]}
{"messages": [{"role": "user", "content": "This query counts the number of drivers created from the leads who have completed vehicle onboarding."}, {"role": "assistant", "content": "WITH leads AS (SELECT pl.partner_onboarding_lead_id, pl.termination_ts, pv.onboarding_vehicle_id, pl.driver_id FROM mart.partner_onboarding_lead_creation pl LEFT JOIN mart.partner_onboarding_vehicle_creation pv ON pl.partner_onboarding_lead_id = pv.lead_id WHERE pl.termination_ts IS NULL AND pv.onboarding_vehicle_id IS NOT NULL), drivers AS (SELECT d.driver_id FROM mart.partner_onboarding_driver_creation d JOIN leads l ON d.driver_id = l.driver_id) SELECT COUNT(DISTINCT driver_id) AS drivers_created FROM drivers;"}]}
{"messages": [{"role": "user", "content": "This query counts the number of drivers who are ready to take orders, either by completing a dummy order (for 2-wheelers) or paying the registration fee (for other vehicle categories)"}, {"role": "assistant", "content": "WITH leads AS (SELECT pl.partner_onboarding_lead_id, pl.termination_ts, pv.onboarding_vehicle_id, pl.driver_id, pv.level0_mapping FROM mart.partner_onboarding_lead_creation pl LEFT JOIN mart.partner_onboarding_vehicle_creation pv ON pl.partner_onboarding_lead_id = pv.lead_id WHERE pl.termination_ts IS NULL AND pv.onboarding_vehicle_id IS NOT NULL), drivers AS (SELECT d.driver_id, d.FIRST_DUMMY_ORDER_COMPLETED_TS_IST, d.REG_FEE_PAID_AT_IST FROM mart.partner_onboarding_driver_creation d JOIN leads l ON d.driver_id = l.driver_id) SELECT COUNT(DISTINCT d.driver_id) AS ready_to_order FROM drivers d JOIN leads l ON d.driver_id = l.driver_id WHERE (l.level0_mapping = '2W' AND d.FIRST_DUMMY_ORDER_COMPLETED_TS_IST IS NOT NULL) OR (l.level0_mapping <> '2W' AND d.REG_FEE_PAID_AT_IST IS NOT NULL);"}]}
{"messages": [{"role": "user", "content": "This query counts the number of drivers who have completed their first real order"}, {"role": "assistant", "content": "WITH leads AS (SELECT pl.partner_onboarding_lead_id, pl.termination_ts, pv.onboarding_vehicle_id, pl.driver_id FROM mart.partner_onboarding_lead_creation pl LEFT JOIN mart.partner_onboarding_vehicle_creation pv ON pl.partner_onboarding_lead_id = pv.lead_id WHERE pl.termination_ts IS NULL AND pv.onboarding_vehicle_id IS NOT NULL),drivers AS (SELECT d.driver_id, d.FIRST_SPOT_ORDER_COMPLETED_TS_IST FROM mart.partner_onboarding_driver_creation d JOIN leads l ON d.driver_id = l.driver_id) SELECT COUNT(DISTINCT d.driver_id) AS first_order_completed FROM drivers d WHERE d.FIRST_SPOT_ORDER_COMPLETED_TS_IST IS NOT NULL ), drivers AS ( SELECT d.driver_id FROM mart.partner_onboarding_driver_creation d JOIN leads l ON d.driver_id = l.driver_id) SELECT COUNT(DISTINCT driver_id) AS drivers_created FROM drivers;"}]}
{"messages": [{"role": "user", "content": "This query calculates daily metrics for the lead-to-driver onboarding process, including lead conversion rates, driver creation time (TAT), and percentiles, while analyzing the efficiency and speed of converting leads into drivers based on various criteria like registration fee payment and document readiness."}, {"role": "assistant", "content": "WITH leads AS ( SELECT mart.PARTNER_ONBOARDING_LEAD_CREATION.* EXCLUDE (level0_mapping, vehicle_category, vehicle_mapping, vehicle_type) , mart.partner_onboarding_vehicle_creation.vehicle_category , mart.partner_onboarding_vehicle_creation.level0_mapping , mart.partner_onboarding_vehicle_creation.vehicle_mapping , mart.partner_onboarding_vehicle_creation.vehicle_type , mart.partner_onboarding_vehicle_creation.onboarding_vehicle_id FROM mart.PARTNER_ONBOARDING_LEAD_CREATION JOIN mart.partner_onboarding_vehicle_creation ON mart.PARTNER_ONBOARDING_LEAD_CREATION.partner_onboarding_lead_id = mart.partner_onboarding_vehicle_creation.lead_id ) , drivers AS ( SELECT d.* FROM mart.partner_onboarding_driver_creation d JOIN leads l ON d.driver_id = l.driver_id ) , final AS ( SELECT l.owner_id , l.owner_created_at_ist , l.onboarding_vehicle_id , l.vehicle_created_at_ist , l.level0_mapping , l.vehicle_category , l.vehicle_mapping , l.vehicle_type , l.city_name , l.tier , l.partner_onboarding_lead_id AS onboarding_lead_id , l.lead_created_at_ist , l.owner_driver , l.reg_fee_payment_attempted , l.reg_fee_paid , l.reg_fee_paid_at_ist , CASE WHEN l.VEHICLE_CATEGORY = '2W' THEN l.REG_FEE_PAID_AT_IST WHEN l.VEHICLE_CATEGORY <> '2W' THEN l.LEAD_CREATED_AT_IST END AS ready_to_verify_at_ist , d.driver_created_at_ist , CASE WHEN l.VEHICLE_CATEGORY = '2W' AND d.FIRST_DUMMY_ORDER_COMPLETED_TS_IST IS NOT NULL THEN TRUE WHEN l.VEHICLE_CATEGORY <> '2W' AND l.reg_fee_paid = TRUE THEN TRUE ELSE FALSE END AS ready_to_order , CASE WHEN l.VEHICLE_CATEGORY = '2W' THEN d.FIRST_DUMMY_ORDER_COMPLETED_TS_IST ELSE l.REG_FEE_PAID_AT_IST END AS ready_to_order_at_ist , CASE WHEN DATEDIFF(day, l.lead_created_at_ist, d.driver_created_at_ist) <= 7 THEN TRUE ELSE FALSE END AS driver_cvr_flag , DATEDIFF(hour, l.lead_created_at_ist, l.REG_FEE_PAID_AT_IST) AS reg_fee_payment_tat , DATEDIFF(day, l.lead_created_at_ist, d.driver_created_at_ist) AS driver_creation_tat FROM leads l LEFT JOIN drivers d ON l.driver_id = d.driver_id ) SELECT DATE_TRUNC(day, lead_created_at_ist) AS date , COUNT(DISTINCT onboarding_lead_id) AS leads_added , COUNT(DISTINCT CASE WHEN driver_created_at_ist IS NOT NULL THEN onboarding_lead_id END) AS drivers_added , COUNT(DISTINCT CASE WHEN driver_cvr_flag THEN onboarding_lead_id END) AS drivers_added_cvr , drivers_added/leads_added AS drivers_cvr , drivers_added_cvr/leads_added AS drivers_cvr_criteria , AVG(driver_creation_tat) AS avg_tat , PERCENTILE_CONT(0.5) WITHIN GROUP(ORDER BY driver_creation_tat) AS p50_tat , PERCENTILE_CONT(0.75) WITHIN GROUP(ORDER BY driver_creation_tat) AS p75_tat FROM final GROUP BY 1 ORDER BY 1;"}]}
{"messages": [{"role": "user", "content": "The query counts the distinct number of drivers added per day based on their creation date "}, {"role": "assistant", "content": "SELECT DATE_TRUNC(day, driver_created_at_ist) AS date ,COUNT(DISTINCT driver_id) AS drivers_added FROM mart.partner_onboarding_driver_creation GROUP BY 1"}]}
{"messages": [{"role": "user", "content": "The query calculates the daily number of drivers added, the number of drivers who became active by completing their first spot order within 7 days, and computes the activated conversion rate (CVR) as the ratio of drivers activated to drivers added"}, {"role": "assistant", "content": "WITH drivers AS ( SELECT * FROM mart.partner_onboarding_driver_creation WHERE driver_created_at_ist between '2025-01-01' and '2025-02-01' ) , leads AS ( SELECT mart.PARTNER_ONBOARDING_LEAD_CREATION.* FROM mart.PARTNER_ONBOARDING_LEAD_CREATION JOIN drivers ON mart.PARTNER_ONBOARDING_LEAD_CREATION.driver_id = drivers.driver_id WHERE 1=1 AND mart.PARTNER_ONBOARDING_LEAD_CREATION.termination_ts IS NULL ) , final AS ( SELECT d.driver_id , d.driver_created_at_ist , d.category_segment , l.reg_fee_paid , CASE WHEN DATEDIFF(day, d.driver_created_at_ist, d.FIRST_SPOT_ORDER_COMPLETED_TS_IST) <= 7 THEN TRUE ELSE FALSE END AS active_cvr_flag FROM drivers d LEFT JOIN leads l ON l.driver_id = d.driver_id ) SELECT DATE_TRUNC(day, driver_created_at_ist) AS date , COUNT(DISTINCT driver_id) AS drivers_added , COUNT(DISTINCT CASE WHEN active_cvr_flag THEN driver_id END) AS drivers_activated_cvr , drivers_activated_cvr/drivers_added AS activated_cvr_criteria FROM final GROUP BY 1;"}]}
{"messages": [{"role": "user", "content": "The query calculates the average activation time to first order (TAT) for drivers who are ready to order and complete their first spot order within 7 days, grouped by day. It calculates the time difference between when the driver is ready to order and when the first order is completed"}, {"role": "assistant", "content": "WITH drivers AS ( SELECT * FROM mart.partner_onboarding_driver_creation WHERE driver_created_at_ist between '2025-01-01' and '2025-02-01' ) , leads AS ( SELECT mart.PARTNER_ONBOARDING_LEAD_CREATION.* FROM mart.PARTNER_ONBOARDING_LEAD_CREATION JOIN drivers ON mart.PARTNER_ONBOARDING_LEAD_CREATION.driver_id = drivers.driver_id WHERE 1=1 AND mart.PARTNER_ONBOARDING_LEAD_CREATION.termination_ts IS NULL ) , final AS ( SELECT d.driver_id , d.driver_created_at_ist , d.category_segment , CASE WHEN d.category_segment = '2W' THEN d.FIRST_DUMMY_ORDER_COMPLETED_TS_IST ELSE l.REG_FEE_PAID_AT_IST END AS ready_to_order_at_ist , d.FIRST_SPOT_ORDER_COMPLETED_TS_IST AS first_order_done_at_ist , CASE WHEN DATEDIFF(day, ready_to_order_at_ist, d.FIRST_SPOT_ORDER_COMPLETED_TS_IST) <= 7 THEN TRUE ELSE FALSE END AS ready_cvr_flag , CASE WHEN ready_cvr_flag THEN DATEDIFF(day, ready_to_order_at_ist, d.FIRST_SPOT_ORDER_COMPLETED_TS_IST) END AS activation_tat FROM drivers d LEFT JOIN leads l ON l.driver_id = d.driver_id ) SELECT DATE_TRUNC(day, driver_created_at_ist) AS date , AVG(activation_tat) AS avg_tat FROM final GROUP BY 1 ORDER BY 1 ;"}]}
{"messages": [{"role": "user", "content": "This query counts the number of distinct activated drivers (where ACTIVE_STATUS = 1) for each vehicle category"}, {"role": "assistant", "content": "SELECT VEHICLE_CATEGORY, COUNT(DISTINCT DRIVER_ID) AS ACTIVATED_DRIVERS_COUNT FROM mart.partner_onboarding_driver_creation WHERE ACTIVE_STATUS = 1 GROUP BY VEHICLE_CATEGORY ORDER BY ACTIVATED_DRIVERS_COUNT DESC;"}]}
{"messages": [{"role": "user", "content": "This query answers what are the drivers who completed their first dummy order and when did they do so, along with their vehicle category"}, {"role": "assistant", "content": "SELECT DRIVER_ID, FIRST_DUMMY_ORDER_COMPLETED_TS_IST, VEHICLE_CATEGORY FROM mart.partner_onboarding_driver_creation WHERE FIRST_DUMMY_ORDER_COMPLETED_TS_IST IS NOT NULL ORDER BY FIRST_DUMMY_ORDER_COMPLETED_TS_IST;"}]}
{"messages": [{"role": "user", "content": "This query will return the vehicle type and the average earnings for drivers within their first 30 days of activation, grouped by each vehicle type."}, {"role": "assistant", "content": "select vehicle_type,avg(first_30d_earnings) from mart.partner_onboarding_driver_creation group by vehicle_type;"}]}
{"messages": [{"role": "user", "content": "This query retrieves the driver_id of all drivers who have completed more than 30 orders within their first 30 days of joining."}, {"role": "assistant", "content": "select driver_id from mart.partner_onboarding_driver_creation where first_30d_orders_done>30;"}]}
{"messages": [{"role": "user", "content": "This query measures how many owners have been onboarded in each month."}, {"role": "assistant", "content": "select DATE_TRUNC(month, owner_created_at_ist) AS date,count(distinct owner_id) as owners from mart.partner_onboarding_owner_creation group by 1;"}]}
{"messages": [{"role": "user", "content": "This query finds the number of vehicle owners who onboarded either a single vehicle or multiple vehicles on a given date, categorizing them by whether they onboarded one type of vehicle or multiple types"}, {"role": "assistant", "content": "WITH owners AS ( SELECT * FROM mart.PARTNER_ONBOARDING_OWNER_CREATION ) , vehicles AS ( SELECT pv.* FROM mart.partner_onboarding_vehicle_creation pv JOIN owners o ON pv.owner_id = o.owner_id QUALIFY ROW_NUMBER() OVER(PARTITION BY pv.lead_id ORDER BY pv.vehicle_created_at_ist DESC) = 1 ) , final AS ( SELECT o.owner_id , o.owner_created_at_ist , v.onboarding_vehicle_id , v.vehicle_category FROM owners o LEFT JOIN vehicles v ON o.owner_id = v.owner_id ) , owner_vehicles AS ( SELECT DATE_TRUNC(day, owner_created_at_ist) AS date , owner_id , CASE WHEN COUNT(DISTINCT VEHICLE_CATEGORY) > 1 THEN 'Multiple Vehicle Types' ELSE 'One Vehicle Type' END AS vehicle_types_added , CASE WHEN COUNT(DISTINCT onboarding_vehicle_id) > 1 THEN 'Multiple Vehicles' ELSE 'Single Vehicle' END AS vehicles_added FROM final WHERE 1=1 AND onboarding_vehicle_id IS NOT NULL GROUP BY 1,2 ) SELECT date , vehicles_added , COUNT(DISTINCT owner_id) AS vehicles FROM owner_vehicles GROUP BY 1,2;"}]}
{"messages": [{"role": "user", "content": "The query calculates the daily count of distinct owners based on the number of vehicles they added, categorizing them into 1 vehicle, 2-10 vehicles, or more than 10 vehicles."}, {"role": "assistant", "content": "WITH owners AS ( SELECT * FROM mart.PARTNER_ONBOARDING_OWNER_CREATION ) , vehicles AS ( SELECT pv.* FROM mart.partner_onboarding_vehicle_creation pv ) , final AS ( SELECT o.owner_id , o.owner_created_at_ist , v.onboarding_vehicle_id FROM owners o LEFT JOIN vehicles v ON o.owner_id = v.owner_id ) , owner_vehicles AS ( SELECT DATE_TRUNC(day, owner_created_at_ist) AS date , owner_id , COUNT(DISTINCT onboarding_vehicle_id) AS vehicles_added FROM final WHERE 1=1 AND onboarding_vehicle_id IS NOT NULL GROUP BY 1,2 ) SELECT date , CASE WHEN vehicles_added = 1 THEN '1' WHEN vehicles_added BETWEEN 2 AND 10 THEN '2-10' WHEN vehicles_added > 10 THEN '10+' END AS vehicles_added , COUNT(DISTINCT owner_id) AS vehicles FROM owner_vehicles GROUP BY 1,2 order by 1 desc,2 "}]}
{"messages": [{"role": "user", "content": "The query calculates the daily count of distinct owners onboarded, owners who added vehicles, and owners who added vehicles within 7 days of onboarding, along with conversion rates for total vehicles added per owner and vehicles added within the 7-day criterion."}, {"role": "assistant", "content": "WITH owners AS ( SELECT * FROM mart.PARTNER_ONBOARDING_OWNER_CREATION ) , vehicles AS ( SELECT pv.* FROM mart.partner_onboarding_vehicle_creation pv ) , final AS ( SELECT o.supply_lead_id , o.supply_created_at_ist , o.owner_id , o.owner_created_at_ist , v.onboarding_vehicle_id , v.vehicle_created_at_ist , v.level0_mapping , v.vehicle_category , v.vehicle_type , v.city_name , v.tier , CASE WHEN DATEDIFF(day, o.owner_created_at_ist, v.vehicle_created_at_ist) <= 7 THEN TRUE ELSE FALSE END AS vehicle_cvr_flag FROM owners o LEFT JOIN vehicles v ON o.owner_id = v.owner_id ) SELECT DATE_TRUNC(day, owner_created_at_ist) AS date , COUNT(DISTINCT owner_id) AS owners , COUNT(DISTINCT CASE WHEN vehicle_created_at_ist IS NOT NULL THEN owner_id END) AS vehicles , COUNT(DISTINCT CASE WHEN vehicle_cvr_flag THEN owner_id END) AS vehicles_cvr , DIV0(vehicles, owners) AS owner_to_vehicle_cvr , DIV0(vehicles_cvr, owners) AS owner_to_vehicle_cvr_criteria FROM final WHERE 1=1 GROUP BY 1 ORDER BY 1 DESC ;"}]}
{"messages": [{"role": "user", "content": "The query retrieves supply leads with no corresponding owner, showing their mobile number, supply creation date, and the reason for non-conversion based on missing Aadhar, PAN, or Selfie documents (or Other Issues if none are missing)."}, {"role": "assistant", "content": "SELECT supply_lead_id, mobile, supply_created_at_ist, CASE -- WHEN owner_id IS NULL THEN 'No Owner Created' WHEN aadhar_uploaded = FALSE THEN 'Missing Aadhar' WHEN pan_uploaded = FALSE THEN 'Missing PAN' WHEN selfie_uploaded = FALSE THEN 'Missing Selfie' ELSE 'Other Issues' END AS non_conversion_reason FROM mart.partner_onboarding_owner_creation WHERE owner_id IS NULL;"}]}
{"messages": [{"role": "user", "content": "This query measures how many vehicles have been registered"}, {"role": "assistant", "content": "SELECT COUNT(DISTINCT onboarding_vehicle_id) AS vehicles_added FROM mart.partner_onboarding_vehicle_creation;"}]}
{"messages": [{"role": "user", "content": "This query counts how many vehicles have an associated lead creation record"}, {"role": "assistant", "content": "SELECT COUNT(DISTINCT pv.onboarding_vehicle_id) AS vehicles_with_leads FROM mart.partner_onboarding_vehicle_creation pv JOIN mart.partner_onboarding_lead_creation pl ON pl.partner_onboarding_lead_id = pv.lead_id WHERE pl.termination_ts IS NULL;"}]}
{"messages": [{"role": "user", "content": "This query tracks how many vehicles have an associated driver"}, {"role": "assistant", "content": "SELECT COUNT(DISTINCT pd.driver_id) AS drivers_created FROM mart.partner_onboarding_vehicle_creation pv JOIN mart.partner_onboarding_lead_creation pl ON pl.partner_onboarding_lead_id = pv.lead_id JOIN mart.partner_onboarding_driver_creation pd ON pl.driver_id = pd.driver_id;"}]}
{"messages": [{"role": "user", "content": "This query retrieves the monthly count of unique vehicles added and unique owners, grouped by level0_mapping (vehicle category), and orders the results by the number of vehicles added in ascending order."}, {"role": "assistant", "content": "SELECT DATE_TRUNC(month, vehicle_created_at_ist) AS date , level0_mapping , COUNT(DISTINCT onboarding_vehicle_id) AS vehicles_added , COUNT(DISTINCT owner_id) AS owners FROM prod_eldoria.mart.partner_onboarding_vehicle_creation GROUP BY 1,2 ORDER BY 3;"}]}
{"messages": [{"role": "user", "content": "This query retrieves the total number of vehicles onboarded per city, ranking cities in descending order based on the number of onboarded vehicles."}, {"role": "assistant", "content": "SELECT city_name, COUNT(onboarding_vehicle_id) AS total_vehicles_onboarded FROM prod_eldoria.mart.partner_onboarding_vehicle_creation GROUP BY city_name ORDER BY total_vehicles_onboarded DESC"}]}
{"messages": [{"role": "user", "content": "This query calculates the daily vehicle-to-lead conversion rate, including the percentage of leads created within 7 days of vehicle onboarding."}, {"role": "assistant", "content": "WITH vehicles AS ( SELECT partner_onboarding_vehicle_creation.* EXCLUDE supply_created_at_ist , po.supply_created_at_ist , po.supply_lead_id FROM mart.partner_onboarding_vehicle_creation JOIN mart.PARTNER_ONBOARDING_OWNER_CREATION po ON partner_onboarding_vehicle_creation.owner_id = po.owner_id QUALIFY ROW_NUMBER() OVER(PARTITION BY partner_onboarding_vehicle_creation.lead_id ORDER BY partner_onboarding_vehicle_creation.vehicle_created_at_ist DESC) = 1 ) , leads AS ( SELECT l.* FROM mart.PARTNER_ONBOARDING_LEAD_CREATION l JOIN vehicles v ON l.partner_onboarding_lead_id = v.lead_id WHERE 1=1 AND l.termination_ts IS NULL -- filtering for first lead submitted by supply leads QUALIFY ROW_NUMBER() OVER(PARTITION BY l.owner_id ORDER BY l.LEAD_CREATED_AT_IST) = 1 ) , final AS ( SELECT v.supply_lead_id , v.supply_created_at_ist , v.owner_id , v.owner_created_at_ist , v.onboarding_vehicle_id , v.vehicle_created_at_ist , v.level0_mapping , v.vehicle_category , v.vehicle_mapping , v.vehicle_type , v.city_name , v.tier , l.partner_onboarding_lead_id AS onboarding_lead_id , l.lead_created_at_ist , l.owner_driver , CASE WHEN DATEDIFF(day, v.vehicle_created_at_ist, l.lead_created_at_ist) <= 7 THEN TRUE ELSE FALSE END AS lead_cvr_flag , DATEDIFF(minute, v.vehicle_created_at_ist, l.lead_created_at_ist) AS lead_creation_tat FROM vehicles v LEFT JOIN leads l ON v.lead_id = l.partner_onboarding_lead_id ) SELECT DATE_TRUNC(day, vehicle_created_at_ist) AS date , COUNT(DISTINCT onboarding_vehicle_id) AS vehicles_added , COUNT(DISTINCT onboarding_lead_id) AS leads_added , COUNT(DISTINCT CASE WHEN lead_cvr_flag THEN onboarding_lead_id END) AS leads_added_cvr , leads_added/vehicles_added AS leads_cvr , leads_added_cvr/vehicles_added AS leads_cvr_criteria FROM final GROUP BY 1 ORDER BY 1;"}]}
{"messages": [{"role": "user", "content": "This query finds the daily count of vehicles added and unique owners for 2W (two-wheelers), grouped by body type (bike/scooter)."}, {"role": "assistant", "content": "SELECT DATE_TRUNC(day, vehicle_created_at_ist) AS date , LOWER(body_type) AS body_type , COUNT(DISTINCT onboarding_vehicle_id) AS vehicles_added , COUNT(DISTINCT owner_id) AS owners FROM mart.partner_onboarding_vehicle_creation WHERE 1=1 AND level0_mapping = '2W' GROUP BY 1,2;"}]}
{"messages": [{"role": "user", "content": "This query calculates the average, median (P50), and 75th percentile (P75) turnaround time (TAT) in hours for drivers created within 7 days of vehicle creation, grouped by date."}, {"role": "assistant", "content": "WITH vehicles AS ( SELECT partner_onboarding_vehicle_creation.* EXCLUDE supply_created_at_ist , po.supply_created_at_ist , po.supply_lead_id FROM mart.partner_onboarding_vehicle_creation JOIN mart.PARTNER_ONBOARDING_OWNER_CREATION po ON partner_onboarding_vehicle_creation.owner_id = po.owner_id QUALIFY ROW_NUMBER() OVER(PARTITION BY partner_onboarding_vehicle_creation.lead_id ORDER BY partner_onboarding_vehicle_creation.vehicle_created_at_ist DESC) = 1 ) , leads AS ( SELECT l.* FROM mart.PARTNER_ONBOARDING_LEAD_CREATION l JOIN vehicles v ON l.partner_onboarding_lead_id = v.lead_id WHERE 1=1 AND l.termination_ts IS NULL -- filtering for first lead submitted by supply leads QUALIFY ROW_NUMBER() OVER(PARTITION BY l.owner_id ORDER BY l.LEAD_CREATED_AT_IST) = 1 ) , drivers AS ( SELECT d.* FROM mart.partner_onboarding_driver_creation d JOIN leads l ON d.driver_id = l.driver_id ) , final AS ( SELECT v.supply_lead_id , v.supply_created_at_ist , v.owner_id , v.owner_created_at_ist , v.onboarding_vehicle_id , v.vehicle_created_at_ist , v.level0_mapping , v.vehicle_category , v.vehicle_mapping , v.vehicle_type , v.city_name , v.tier , l.partner_onboarding_lead_id AS onboarding_lead_id , l.lead_created_at_ist , l.owner_driver , d.driver_created_at_ist , CASE WHEN DATEDIFF(day, v.vehicle_created_at_ist, d.driver_created_at_ist) <= 7 THEN TRUE ELSE FALSE END AS driver_cvr_flag , CASE WHEN driver_cvr_flag THEN DATEDIFF(hour, v.vehicle_created_at_ist, d.driver_created_at_ist) END AS driver_creation_tat FROM vehicles v LEFT JOIN leads l ON v.lead_id = l.partner_onboarding_lead_id LEFT JOIN drivers d ON l.driver_id = d.driver_id ) SELECT DATE_TRUNC(day, vehicle_created_at_ist)::DATE AS date , AVG(driver_creation_tat) AS avg_tat , PERCENTILE_CONT(0.5) WITHIN GROUP(ORDER BY driver_creation_tat) AS p50_tat , PERCENTILE_CONT(0.75) WITHIN GROUP(ORDER BY driver_creation_tat) AS p75_tat FROM final GROUP BY 1 ORDER BY 1 ;"}]}
{"messages": [{"role": "user", "content": "The query will return the document type (DOCUMENT_NAME) and the count of documents submitted for each type, ordered by the document type with the highest submission count. "}, {"role": "assistant", "content": "SELECT DOCUMENT_NAME, COUNT(DOC_COUNT) AS DOCUMENT_SUBMITTED_COUNT FROM mart.partner_onboarding_document_approval WHERE DOC_STATUS_ID IS NOT NULL GROUP BY DOCUMENT_NAME ORDER BY DOCUMENT_SUBMITTED_COUNT DESC;"}]}
{"messages": [{"role": "user", "content": "The query calculates the daily number of drivers added, the number of drivers who became active by completing their first spot order within 7 days, and computes the activated conversion rate (CVR) as the ratio of drivers activated to drivers added"}, {"role": "assistant", "content": "SELECT DOC_STATUS, COUNT(DOC_COUNT) AS DOCUMENT_COUNT FROM mart.partner_onboarding_document_approval WHERE DOC_STATUS IS NOT NULL GROUP BY DOC_STATUS ORDER BY DOCUMENT_COUNT DESC;"}]}
{"messages": [{"role": "user", "content": "TThis query will return the document approval type (Auto, Manual, Null, or 'Other') and the count of documents for each type, ordered by the highest count."}, {"role": "assistant", "content": "SELECT CASE WHEN ACTUAL_ACTIONED_BY IS NULL THEN 'Null' WHEN ACTUAL_ACTIONED_BY = 'auto' THEN 'Auto' WHEN ACTUAL_ACTIONED_BY = 'manual' THEN 'Manual' ELSE 'Other' END AS DOCUMENT_APPROVAL_TYPE, COUNT(DOC_COUNT) AS DOCUMENT_COUNT FROM mart.partner_onboarding_document_approval GROUP BY DOCUMENT_APPROVAL_TYPE ORDER BY DOCUMENT_COUNT DESC;"}]}
{"messages": [{"role": "user", "content": "The query will return the document name, the number of approved documents, the total documents submitted, and the approval rate (as a percentage) for each document type, ordered by the highest approval rate."}, {"role": "assistant", "content": "SELECT DOCUMENT_NAME, COUNT(CASE WHEN DOC_STATUS = 'Accepted' THEN 1 END) AS APPROVED_DOCUMENTS, COUNT(DOC_COUNT) AS TOTAL_DOCUMENTS, (COUNT(CASE WHEN DOC_STATUS = 'Accepted' THEN 1 END) * 100.0) / COUNT(DOC_COUNT) AS APPROVAL_RATE FROM mart.partner_onboarding_document_approval GROUP BY DOCUMENT_NAME ORDER BY APPROVAL_RATE DESC;"}]}
{"messages": [{"role": "user", "content": "The query will return the reason wise rate of documents rejection."}, {"role": "assistant", "content": "SELECT DOC_STATUS_REASON, COUNT(DOC_COUNT) AS REJECTED_DOCUMENTS, (COUNT(DOC_COUNT) * 100.0) / (SELECT COUNT(*) FROM mart.partner_onboarding_document_approval where DOC_STATUS = 'Rejected' ) AS rejection_rate FROM mart.partner_onboarding_document_approval WHERE DOC_STATUS = 'Rejected' GROUP BY DOC_STATUS_REASON ORDER BY REJECTION_PERCENTAGE DESC;"}]}
